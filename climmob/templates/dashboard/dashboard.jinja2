<!DOCTYPE html>
<html>

<head>
    {% block meta %}
        {% include 'snippets/google_analytics.jinja2' %}
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="{{ request.url_for_static('landing/icon.png') }}">
    {% endblock meta %}

    {% block title %}
        <title>{{ _("ClimMob") }}</title>
    {% endblock title %}

    {% block css %}
        {% cssresource request,'coreresources','c3' %}
        {% cssresource request,'coreresources','style' %}
        {% cssresource request,'coreresources','sweet' %}
        {% cssresource request,'coreresources','tour' %}
        {% cssresource request,'coreresources','toastr' %}
        {% cssresource request,'coreresources','icheck' %}

    {% endblock css %}

    {% block topScripts %}

        {% jsresource request,'coreresources','dashboard' %}
        {% jsresource request,'coreresources','sweet' %}
        {#    {% jsresource request,'coreresources','delete' %}#}
        {% jsresource request,'coreresources','toastr' %}
        {% include 'snippets/delete.jinja2' %}
        {% jsresource request,'coreresources','d3' %}
        {% jsresource request,'coreresources','c3' %}
        {% jsresource request,'coreresources','tour' %}
        {% jsresource request,'coreresources','icheck' %}

    {% endblock topScripts %}

</head>

{% set withsidebar = [] %}

<body class="{% block bodyclass %}{% endblock bodyclass %}" {% block bodyattributes %}{% endblock bodyattributes %}>
{% block body %}
    <style>
        .liPhrases:hover svg {
            fill: white;
        }
    </style>
    <div id="wrapper">
        {% block mainavbar %}
            <nav class="navbar-default navbar-static-side" role="navigation" style="z-index: initial">
                <div class="sidebar-collapse">
                    <ul class="nav metismenu" id="side-menu">
                        {% block mainavheader %}
                            <li class="nav-header">
                                <div class="dropdown profile-element">
                                    <span>
                                        {% block mnavuserimage %}
                                            <img alt="image" class="img-circle" src="{{ activeUser.gravatarURL }}" />
                                        {% endblock mnavuserimage %}
                                    </span>
                                    {% block mnavuserdm %}
                                        <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                                        <span class="clear">
                                            {% block mnavuserdetails %}
                                                <span class="block m-t-xs"> <strong class="font-bold">{{ activeUser.fullName }}</strong></span>
                                                <span class="text-muted text-xs block">{{ _("Actions") }} <b class="caret"></b></span>
                                            {% endblock mnavuserdetails %}
                                        </span>
                                        </a>
                                        <ul class="dropdown-menu animated fadeInRight m-t-xs">
                                            {% block mnavusermitems %}
                                                <li><a href="{{ request.route_url('profile') }}">{{ _("Profile") }}</a></li>
                                                <li class="divider"></li>
                                                <li><a href="{{ request.route_url('logout') }}">{{ _("Logout") }}</a></li>
                                            {% endblock mnavusermitems %}
                                        </ul>
                                    {% endblock mnavuserdm %}
                                </div>
                                <div class="logo-element">
                                    {% block mainavlogo %}
                                        CM
                                    {% endblock mainavlogo %}
                                </div>
                            </li>
                        {% endblock mainavheader %}
                        {% block mainavitems %}
                            <li {% if not sectionActive %}class="active" {% endif %}>
                                <a href="{{ request.route_url('dashboard') }}"><i class="fa fa-th-large"></i> <span class="nav-label">{{ _("Project overview") }}</span></a>
                            </li>
                            <li {% if sectionActive == "projectlist" %}class="active" {% endif %}>
                                <a href="{{ request.route_url('projectList')  }}"><i class="fa fa-tasks"></i> {{ _("All projects") }}</a>
                            </li>
                            <li class="active" style="border-left: initial;background: initial" id="nav_libraries">
                                <a href="#" style="color: #a7b1c2;"><i class="fa fa-book"></i> <span class="nav-label">{{ _("Library") }}</span><span class="fa arrow"></span></a>
                                <ul class="nav nav-second-level collapse " style="border-left: initial;background: initial">
                                    <li id="nav_enumerators" {% if sectionActive == "fieldagents" %}class="active" style="border-left: 4px solid #19aa8d;background: #293846;" {% endif %}><a href="{{ request.route_url('enumerators') }}"><i class="fa fa-group"></i> <span class="nav-label">{{ _("Field agents") }}</span></a></li>
                                    <li id="nav_technology" {% if sectionActive == "technologies" %}class="active" style="border-left: 4px solid #19aa8d;background: #293846;"{% endif %}><a href="{{ request.route_url('usertechnologies') }}"><i class="fa fa-flask"></i> <span class="nav-label">{{ _("Technologies") }}</span></a></li>
                                    <li id="nav_questions" {% if sectionActive == "questions" %}class="active" style="border-left: 4px solid #19aa8d;background: #293846;"{% endif %}><a href="{{ request.route_url('qlibrary',user_name =activeUser.login) }}"><i class="fa fa-comment"></i> <span class="nav-label">{{ _("Questions") }}</span></a></li>
                                    <li id="nav_phrases" {% if sectionActive == "otherLanguages" %}class="active liPhrases" style="border-left: 4px solid #19aa8d;background: #293846;"{% else %}class="liPhrases"{% endif %}>
                                        <a href="{{ request.route_url('otherLanguages') }}">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" height="13" class="fa" fill="{% if sectionActive == "otherLanguages" %}#ffffff{% else %}#a7b1c2{% endif %}" style="margin-right: 6px">
                                                <path d="M0 128C0 92.7 28.7 64 64 64H256h48 16H576c35.3 0 64 28.7 64 64V384c0 35.3-28.7 64-64 64H320 304 256 64c-35.3 0-64-28.7-64-64V128zm320 0V384H576V128H320zM178.3 175.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1 .1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4l-64-144zM160 233.2L179 276H141l19-42.8zM448 164c11 0 20 9 20 20v4h44 16c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4c.9 .6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9l-18.9-11.3c-4.5-2.7-8.8-5.5-13.1-8.5c-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8l-12.2-12.2c-7.8-7.8-7.8-20.5 0-28.3s20.5-7.8 28.3 0l14.6 14.6 .5 .5c12.4-13.1 22.5-28.3 29.8-45H448 376c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20z"/>
                                            </svg><span class="nav-label">{{ _("Local languages") }}</span>
                                        </a>
                                    </li>
                                    {% if activeUser.admin == 1 %}
                                        <li id="nav_librarymetadata" {% if sectionActive == "librarymetadata" %}class="active" style="border-left: 4px solid #19aa8d;background: #293846;"{% endif %}><a href="{{ request.route_url('librarymetadata') }}"><i class="fa fa-file-text"></i><span class="nav-label">{{ _("Metadata forms") }}</span></a></li>
                                    {% endif %}
                                </ul>
                            </li>
                            <li id="nav_downloads" {% if sectionActive == "productlist" %}class="active" {% endif %}>
                                <a href="{{ request.route_url('productList') }}"><i class="fa fa-cloud-download"></i> <span class="nav-label">{{ _("Downloads") }}</span></a>
                            </li>

                            {% if not activeUser.technologies or not activeUser.projectsByUserThatRequireSetup%}
                                <li class="active" style="border-left: initial;background: initial" id="nav_curations">
                                    <a href="#" style="color: #a7b1c2;"><i class="fa fa-gears"></i> <span class="nav-label">{{ _("Curation") }}</span><span class="fa arrow"></span></a>
                                    <ul class="nav nav-second-level collapse " style="border-left: initial;background: initial">

                                        {% if not activeUser.technologies %}
                                            <li id="nav_curationoftechnologies" {% if sectionActive == "curationoftechnologies" %}class="active" style="border-left: 4px solid #19aa8d;background: #293846;" {% endif %}><a href="{{ request.route_url('curationoftechnologies') }}"><i class="fa fa-flask"></i> <span class="nav-label">{{ _("Technologies") }}</span></a></li>
                                        {% endif %}

                                        {% if not activeUser.projectsByUserThatRequireSetup%}
                                            <li id="nav_curationofprojects" {% if sectionActive == "curationofprojects" %}class="active" style="border-left: 4px solid #19aa8d;background: #293846;"{% endif %}><a href="{{ request.route_url('curationofprojects') }}"><i class="fa fa-tasks"></i> <span class="nav-label">{{ _("Projects") }}</span></a></li>
                                        {% endif %}

                                    </ul>
                                </li>
                            {% endif %}

                            {% if activeUser.login == "bioversity" %}
                                <li {% if sectionActive == "projecthelp" %}class="active" {% endif %}>
                                    <a href="{{ request.route_url('projectHelp') }}"><i class="fa fa-cog"></i> <span class="nav-label">{{ _("Project help") }}</span></a>
                                </li>
                            {% endif %}

                            {% if activeUser.admin == 1 %}
                                <li id="nav_projectssummary" {% if sectionActive == "projectssummary" %}class="active" {% endif %}>
                                    <a href="{{ request.route_url('projectsSummary') }}"><i class="fa fa-database"></i> <span class="nav-label">{{ _("Projects summary") }}</span></a>
                                </li>
                            {% endif %}

                            {% block extra_options_for_servers_integration %}

                            {% endblock extra_options_for_servers_integration %}

                            {% block extra_option_menu_user_administration %}

                            {% endblock extra_option_menu_user_administration %}

                        {% endblock mainavitems %}
                    </ul>
                </div>
            </nav>
        {% endblock mainavbar %}
        <div id="page-wrapper" class="gray-bg">
            {% block header %}
                <div class="row border-bottom">
                    <nav class="navbar navbar-static-top  " role="navigation" style="margin-bottom: 0">
                        <div class="navbar-header" style="min-width: 50%">
                            {% block headwelcome %}
                                <a class="navbar-minimalize minimalize-styl-2 btn btn-primary" href="#"><i class="fa fa-bars"></i> </a>
                                <h2 style="margin: 14px 5px 5px 20px"> <span style="color: #1ab492">{{ _("ClimMob") }}</span></h2>
                            {% endblock headwelcome %}
                        </div>
                        <ul class="nav navbar-top-links navbar-right">
                            {% block headitems %}
                                <li class="li_languages">
                                    {{ _('Language') }}:
                                    <select id="language">
                                        <option id="en" value="en">English</option>
                                        <option id="es" value="es">Español</option>
                                        <option id="fr" value="fr">Français</option>
                                    </select>
                                </li>
                                <li>
                                    <a href="{{ request.route_url('logout') }}">
                                        <i class="fa fa-sign-out"></i> {{ _("Log out") }}
                                    </a>
                                </li>
                                <li>
                                    {% block headsidebar %}
                                        <a class="right-sidebar-toggle" href="{{ request.route_url('projectList') }}">
                                            <i class="fa fa-tasks"> </i> {{ _("All projects") }}
                                            {% do withsidebar.append(1) %}
                                        </a>
                                    {% endblock headsidebar %}
                                </li>
                            {% endblock headitems %}
                        </ul>
                    </nav>
                </div>
            {% endblock header %}

            {% block extraHeader %}

            {% endblock extraHeader %}

            {% block pageheading %}
                {% if hasActiveProject %}
                    <div class="row" style="background-color: white">

                        <div class="col-lg-12">
                            <div class="ibox-content" style="padding: 5px 20px 10px 20px;">
                                <table width="100%">
                                    <tr>
                                        {% block project_heading_info %}
                                            <td width="95%">
                                                <h2 ><strong>{{ activeProject.project_name }}</strong></h2>
                                            </td>
                                            <td rowspan="2" class="text-center">
                                                <a class="btn btn-success btn-rounded  btn-xs" style="color: white" href="https://climmob.net/blog/wiki/4-project-definition-navigate-the-project/" target="_blank"><i class="fa fa-question-circle"></i> {{  _("Show help") }}</a>
                                            </td>
                                        {% endblock project_heading_info %}
                                    </tr>
                                    <tr>
                                        <td style="vertical-align: middle">
                                            {{ activeProject.project_abstract}}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endblock pageheading %}
            <div class="wrapper wrapper-content">
                {% block pagecontent %}

                    {% include 'forms/UMUX_Lite.jinja2' %}

                    {% if surveyMustBeDisplayed == "umuxlite" %}

                        <script>
                            $(document).ready(function() {
                                $('#umuxLiteModal').modal('show');
                            });
                        </script>

                    {% endif %}

                    {% if hasActiveProject %}
                        <div class="row">
                            <div class="col-md-6">
                                <div class="ibox float-e-margins">
                                    <div class="ibox-title">

                                        <div class="ibox-tools">
                                            <div class="row" style="padding: 5px">
                                                <table style="width: 100%">
                                                    <tbody>
                                                        <tr>
                                                            <td style="vertical-align: middle; width: 50%;text-align: left;">
                                                                <h5>{{ _("Project definition") }}</h5>
                                                            </td>
                                                            <td style="vertical-align: middle; text-align: center">
                                                                <div class="small" style="text-align: left">{{ pcompleted }}% {{ _("Completed") }}</div>
                                                                <div class="progress progress-mini" style="width: 85%">
                                                                    <div style="width: {{ pcompleted }}%;" class="progress-bar progress-bar-success"></div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="ibox-content">
                                        <div class="row">
                                            <div class="col-md-9">
                                                <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('modifyproject',user=activeProject["owner"].user_name, project=activeProject.project_cod) }}" ><i class="fa fa-list-alt"></i> {{ _("1. Project profile") }}</a>
                                            </div>
                                            <div class="col-md-3">
                                                <p style="margin-top: 8px; text-align: center"><span class="label label-success">{{ _("Completed") }}</span></p>
                                            </div>
                                        </div>
                                        {% if activeProject["project_template"] != 1 %}
                                            <div class="row">
                                                {% block progress_enumerators %}
                                                    <div class="col-md-9">
                                                        <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" {% if progress.enumerators_by_user == 0 %} onclick="seeHelp()" {% else %} href="{{ request.route_url('prjenumerators',user=activeProject["owner"].user_name, project=activeProject["project_cod"]) }}" {% endif %}><i class="fa fa-user-circle-o"></i> {{ _("2. Assign field agents") }} {% if progress.numberOfFieldAgents > 0 %} <span class="label b-r-xl label-default" style="background-color: white; color: black; float: right!important; margin-top: 2px" title="{{ progress.numberOfFieldAgents }} {{ _("field agents assigned") }}">{{ progress.numberOfFieldAgents }} {{ _("Assigned") }}</span> {% endif %} </a>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <p style="margin-top: 8px; text-align: center"><span class="label {% if progress.enumerators %}label-success{% else %}label-danger{% endif %}">{% if progress.enumerators %}{{ _("Completed") }}{% else %}{{ _("Pending") }}{% endif %}</span></p>
                                                    </div>
                                                {% endblock %}
                                            </div>
                                        {% endif %}
                                        {% if activeProject["project_template"] != 1 %}
                                            <div class="row">
                                                <div class="col-md-9">
                                                    <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" {% if activeProject["project_createpkgs"] ==2 %} disabled {% else %} href="{{ request.route_url('prjtechnologies', user=activeProject["owner"].user_name, project=activeProject["project_cod"]) }}" {% endif %}><i class="fa fa-envira"></i> {{ _("3. Assign technologies") }} {% if progress.numberOfCombinations > 0 %} <span class="label b-r-xl label-default" style="background-color: white; color: black; float: right!important; margin-top: 2px" title="{{ progress.numberOfCombinations }} {{ _("technology options assigned") }}">{{ progress.numberOfCombinations }} {{ _("Assigned") }}</span> {% endif %} </a>
                                                </div>
                                                <div class="col-md-3">
                                                    <p style="margin-top: 8px; text-align: center">
                                                        {% if progress.numberOfCombinations > 50 %}
                                                            <span class="label label-danger">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ _("Error") }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                                        {% else %}
                                                            {% if progress.technology and progress.techalias %}
                                                                <span class="label label-success">{{ _("Completed") }}</span>
                                                            {% endif %}
                                                            {% if progress.technology and not progress.techalias %}
                                                                <span class="label label-warning" title="There are assigned treatments but without levels">{{ _("Partial") }}</span>
                                                            {% endif %}
                                                            {% if not progress.technology and not progress.techalias %}
                                                                <span class="label label-danger">{{ _("Pending") }}</span>
                                                            {% endif %}
                                                        {% endif %}
                                                    </p>
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="row">
                                            <div class="col-md-9">
                                                {% if activeProject.project_registration_and_analysis == 0 %}
                                                    <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('registry', user=activeProject["owner"].user_name, project=activeProject.project_cod) }}"><i class="fa fa-address-card-o"></i> {{ _("4. Prepare participant registration form") }} {% if progress.numberOfQuestionsInRegistry > 0 %} <span class="label b-r-xl label-default" style="background-color: white; color: black; float: right!important; margin-top: 2px" title="{{ progress.numberOfQuestionsInRegistry }} {{ _("questions assigned to the form") }}">{{ progress.numberOfQuestionsInRegistry }} {{ _("questions") }}</span> {% endif %}</a>
                                                {% else %}
                                                    <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('registry', user=activeProject["owner"].user_name, project=activeProject.project_cod) }}"><i class="fa fa-address-card-o"></i> {{ _("4. Participant registration and trial data collection") }} {% if progress.numberOfQuestionsInRegistry > 0 %} <span class="label b-r-xl label-default" style="background-color: white; color: black; float: right!important; margin-top: 2px" title="{{ progress.numberOfQuestionsInRegistry }} {{ _("questions assigned to the form") }}">{{ progress.numberOfQuestionsInRegistry }} {{ _("questions") }}</span> {% endif %} </a>
                                                {% endif %}
                                            </div>
                                            <div class="col-md-3">
                                                <p style="margin-top: 8px; text-align: center;">
                                                    {% if progress.registry %}
                                                        <span class="label label-success">{{ _("Completed") }}</span>
                                                    {% else %}
                                                        <span class="label label-danger">{{ _("Pending") }}</span>
                                                    {% endif %}
                                                </p>
                                            </div>
                                        </div>
                                        {% if activeProject.project_registration_and_analysis != 1 %}
                                            <div class="row">
                                                <div class="col-md-9">

                                                    <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('assessment',user=activeProject["owner"].user_name, project=activeProject.project_cod) }}" ><i class="fa fa-balance-scale"></i> {{ _("5. Prepare trial data collection") }} {% if progress.assessments|length > 0 %} <span class="label b-r-xl label-default" style="background-color: white; color: black; float: right!important; margin-top: 2px" title="{{ progress.assessments|length }} {{ _(" data collection moments created") }}">{{ progress.assessments|length }} {{ _("forms") }}</span> {% endif %}</a>

                                                </div>
                                                <div class="col-md-3">
                                                    <p style="margin-top: 8px; text-align: center">
                                                        {% if progress.assessment %}
                                                            <span class="label label-success">{{ _("Completed") }}</span>
                                                        {% else %}
                                                            <span class="label label-danger">{{ _("Pending") }}</span>
                                                        {% endif %}
                                                    </p>
                                                </div>
                                            </div>
                                        {% endif %}
                                        <div class="row">
                                            <div class="col-md-9">
                                                {% if activeProject.project_registration_and_analysis == 0 %}
                                                    <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('Metadata', user=activeProject["owner"].user_name, project=activeProject.project_cod) }}"><i class="fa fa-file-text"></i> {{ _("6. Trial documentation") }}</a>
                                                {% else %}
                                                    <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('Metadata', user=activeProject["owner"].user_name, project=activeProject.project_cod) }}"><i class="fa fa-file-text"></i> {{ _("5. Trial documentation") }}</a>
                                                {% endif %}
                                            </div>
                                            <div class="col-md-3">
                                                <p style="margin-top: 8px; text-align: center;">
                                                    {% if progress.metadata %}
                                                        <span class="label label-success">{{ _("Completed") }}</span>
                                                    {% else %}
                                                        <span class="label label-danger">{{ _("Pending") }}</span>
                                                    {% endif %}
                                                </p>
                                            </div>
                                        </div>

                                        {% if activeProject["project_template"] != 1 %}

                                            <div class="row">
                                                <div class="col-md-9">
                                                    <a class="btn btn-primary btn-rounded btn-block" style="text-align: left;width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('shareProject',user=activeProject["owner"].user_name, project=activeProject["project_cod"]) }}" ><i class="fa fa-group"></i> {{ _("Share project with other users") }}</a>
                                                </div>
                                                <div class="col-md-3">
                                                </div>
                                            </div>

                                        {% endif %}

                                        {% block dataExchange_additionalsection_for_synchronize_information %}

                                        {% endblock dataExchange_additionalsection_for_synchronize_information %}

                                        {% if activeProject["project_template"] != 1 %}
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <br>
                                                    <div class="text-center">
                                                        <h3>{{ _("Share this link to show trial progress") }}:</h3>
                                                        <br>
                                                        <input readonly class=" form-control " style="margin-bottom: 5px; padding: 6px 12px; border-color: #1ab394; border-radius: 3px" type="text" id="aForCopy" value="{{ request.route_url("projectInformation", id = encrypted) }}" >
                                                        <button class="btn btn-default" onclick="copy()">{{ _("Copy to clipboard") }}</button>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>

                                {% if activeProject["project_template"] != 1 %}
                                    {% if activeProject.project_registration_and_analysis != 1 %}
                                    <div class="ibox float-e-margins">
                                        <div class="ibox-title">

                                            <div class="ibox-tools">
                                                <div class="row">
                                                    <div class="col-md-8">
                                                        <h5>{{ _("Start trial data collection moments") }}</h5>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ibox-content">
                                            <div class="row">

                                                {% if progress["enumerators"] and progress["technology"] and progress["techalias"] and progress["registry"] and progress["assessment"] and progress.regsubmissions == 2  %}
{#                                                    <div class="text-left" style="padding: 15px;">#}
{#                                                        <p>{{ _("Please check the following types of questions are in the started assessments or include them in the next assessments:") }}</p>#}
{#                                                        <span style="font-size: 16px;font-weight: 600;" title="{{ _("You have included ")}}{{ progress.analysisControl.Characteristics }}{{ _(" Ranking of options") }}"><i  class="fa {% if progress.analysisControl.Characteristics > 0 %}fa-check{% else %}fa-times{% endif %}" style="font-size: 16px;font-weight: 600;color: {% if progress.analysisControl.Characteristics > 0 %}#1ab394{% else %}#ed5565{% endif %}" ></i> {{ _("Ranking of options") }}</span><br>#}
{#                                                        <span style="font-size: 16px;font-weight: 600;" title="{{ _("You have included ")}}{{ progress.analysisControl.Performance }}{{ _(" Comparison with check") }}"><i  class="fa {% if progress.analysisControl.Performance > 0 %}fa-check{% else %}fa-times{% endif %}" style="font-size: 16px;font-weight: 600;color: {% if progress.analysisControl.Performance > 0 %}#1ab394{% else %}#ed5565{% endif %}" ></i> {{ _("Comparison with check") }}</span><br>#}
{#                                                        <span style="font-size: 16px;font-weight: 600;" title="{{ _("You have included ")}}{{ progress.analysisControl.Explanatory }}{{ _(" Explanatory variables") }}"><i  class="fa {% if progress.analysisControl.Explanatory > 0 %}fa-check{% else %}fa-times{% endif %}" style="font-size: 16px;font-weight: 600;color: {% if progress.analysisControl.Explanatory > 0 %}#1ab394{% else %}#ed5565{% endif %}" ></i> {{ _("Explanatory variables") }}</span><br>#}
{#                                                        <span style="font-size: 16px;font-weight: 600;" {% if progress.analysisControl.overralCharacteristic !="" %}title="{{ _("You have included this question in the assessment") }}: '{{ progress.analysisControl.overralCharacteristic }}'" {% endif %}><i  class="fa {% if progress.analysisControl.overralCharacteristic !="" %}fa-check{% else %}fa-times{% endif %}" style="font-size: 16px;font-weight: 600;color: {% if progress.analysisControl.overralCharacteristic != "" %}#1ab394{% else %}#ed5565{% endif %}" ></i> {{ _("Overall ranking of options") }}</span><br>#}
{#                                                        <span style="font-size: 16px;font-weight: 600;" {% if progress.analysisControl.overralPerformance !="" %}title="{{ _("You have included this question in the assessment") }}: '{{ progress.analysisControl.overralPerformance }}'" {% endif %}><i  class="fa {% if progress.analysisControl.overralPerformance !="" %}fa-check{% else %}fa-times{% endif %}" style="font-size: 16px;font-weight: 600;color: {% if progress.analysisControl.overralPerformance != "" %}#1ab394{% else %}#ed5565{% endif %}" ></i> {{ _("Overall comparison with check") }}</span>#}
{#                                                    </div>#}
                                                    <div class="col-md-12">
                                                        <br>
                                                        {% if progress.usableAssessments|length > 0 %}
                                                            {% include 'snippets/error.jinja2' %}
                                                            <form class="formElement" id="start_assessment"  role="form" method="post" action="{{ request.route_url("startassessments",user=activeProject["owner"].user_name, project=activeProject.project_cod) }}">
                                                                <div class="form-group">
                                                                    <label>{{ _("Select the form to start the trial data collection") }}</label>
                                                                    <select id="assessment_id" name="assessment_id" class="form-control">
                                                                            {% for assessment in progress["usableAssessments"] %}
                                                                                <option value="{{ assessment.ass_cod }}">{{ assessment.ass_desc }}</option>>
                                                                            {% endfor %}
                                                                        </select>
                                                                </div>
                                                                <input type="hidden" name="csrf_token" value="{{ request.session.get_csrf_token() }}">
                                                                <button id="start_assessment_button" class="btn btn-primary btn-rounded btn-block" type="submit" name="start_assessment_button"> <i class="fa fa-play"></i> {{ _("Start an trial data collection moment") }}</button>
                                                            </form>
                                                        {% endif %}
                                                    </div>
                                                {% else %}
                                                    <div class="col-md-12">
                                                        <div class="text-center"><p>{{ _("You can start the trial data collection once the registration of participants is closed and the project definition is completed") }}</p></div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endif %}

                            </div>
                            <div class="col-md-6">
                                {% if activeProject["project_template"] != 1 %}
                                    <div class="ibox float-e-margins">
                                        <div class="ibox-title">

                                            <div class="ibox-tools">
                                                <div class="row" style="padding: 5px">

                                                    <table style="width: 100%">
                                                        <tbody>
                                                            <tr>
                                                                <td style="vertical-align: middle; width: 50%;text-align: left;">
                                                                    <h5 style=" margin: initial">{{ _("Participant registration") }}</h5>
                                                                </td>
                                                                <td style="vertical-align: middle; text-align: center">
                                                                    {% set pbtype = "progress-bar-info" %}
                                                                    {% if progress.regsubmissions == 0 %}
                                                                        <div class="small" style="text-align: left">{{ _("Not yet started") }}</div>
                                                                    {% endif %}
                                                                    {% if progress.regsubmissions == 1 %}
                                                                        <div class="small" style="text-align: left">{{ _("On going") }}</div>
                                                                    {% endif %}
                                                                    {% if progress.regsubmissions == 2 %}
                                                                        <div class="small" style="text-align: left">{{ _("Closed") }}</div>
                                                                        {% if progress.regperc >= 100 %}
                                                                            {% set pbtype = "progress-bar-success" %}
                                                                        {% else %}
                                                                            {% set pbtype = "progress-bar-warning" %}
                                                                        {% endif %}
                                                                    {% endif %}
                                                                    <div class="progress progress-mini">
                                                                        <div style="width: {{ progress.regperc }}%;" class="progress-bar {{ pbtype }}"></div>
                                                                    </div>
                                                                </td>
                                                                <td style="vertical-align: middle;text-align: center; width: 10%">
                                                                    <a class="collapse-link">
                                                                        <i class="fa fa-chevron-{% if progress.regsubmissions == 2 %}down{% else %}up{% endif %}"></i>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ibox-content" {% if progress.regsubmissions == 2 %}style="display: none"{% endif %}>

                                            {% if progress.regsubmissions == 0 %}
                                                <div class="row">
                                                    {% if progress.enumerators == true and progress.technology == true and progress.techalias == true and progress.registry == true %}
                                                        <div class="col-md-12">
                                                            <button class="btn btn-primary btn-rounded btn-block" onclick="location.href='{{ request.route_url('combinations',user=activeProject["owner"].user_name, project=activeProject.project_cod,  _query={"stage": 1}) }}'"><i class="fa fa-play"></i> {{ _("Generate packages with technology options") }}<br/> {{ _("and open the registration of participants") }}</button>
                                                        </div>
                                                    {% else %}
                                                        <div class="col-md-12">
                                                            <div class="text-center">{{ _("You can start the registration of participants once the project has assigned field agents, technology and its options have been selected and a registration form has been prepared") }}</div>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            {% endif %}


                                            {% if progress.regsubmissions == 1 or progress.regsubmissions == 2  %}
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h3>{{ _("Statistics") }}</h3>
                                                        <div id="pieRegistry" ></div>
                                                        <table class="table table-striped">
                                                            <tbody>
                                                            <tr>
                                                                <td>{{ _("Total number of participants") }}: </td>
                                                                <td>{{ activeProject.project_numobs }}</td>
                                                            </tr>
                                                            <tr >
                                                                <td style="vertical-align: inherit">{{ _("Number of submissions") }}: </td>
                                                                <td style="vertical-align: inherit">{{ progress.regtotal }} {% if progress.regtotal > 0 %}({{  ((progress.regtotal * 100)/activeProject.project_numobs)|round(1, 'floor') }}%){% endif %}</td>

                                                            </tr>
                                                            <tr>
                                                                <td {% if progress.regerrors > 0 and progress.regsubmissions == 1%}style="color: #ed5565;" {% endif %}>{{ _("Submissions with conflicts") }}:</td>
                                                                <td {% if progress.regerrors > 0 and progress.regsubmissions == 1%}style="color: #ed5565;" {% endif %}>{{ progress.regerrors }}</td>
                                                            </tr>
                                                            <tr>
                                                                <td >{{ _("Last submission") }}</td>
                                                                <td >{{ progress.lastreg }}</td>
                                                            </tr>
                                                            {% if progress.regsubmissions == 1 %}

                                                                {% block upload_data_registry %}

                                                                {% endblock upload_data_registry %}

                                                                {% block enketo_information_registry %}

                                                                {% endblock enketo_information_registry %}

                                                            {% endif %}

                                                            <tr>
                                                                <td colspan="2">
                                                                    {% if progress.regtotal > 0 %}
                                                                        <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('EditDataRegistry',user=activeProject["owner"].user_name,project=activeProject.project_cod,formid='registry') }}"><i class="fa fa-table"></i> {{ _("View and edit data") }}</a>

                                                                        <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('downloadDataRegistry',user=activeProject["owner"].user_name,project=activeProject.project_cod,formid='registry', formatid='csv') }}"><i class="fa fa-cloud-download"></i> {{ _("Download data in .CSV format") }}</a>
                                                                        <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('downloadDataRegistry',user=activeProject["owner"].user_name,project=activeProject.project_cod,formid='registry', formatid='xlsx') }}"><i class="fa fa-cloud-download"></i> {{ _("Download data in .XLSX format") }}</a>

                                                                        {% block dataprivacy_download_data_registry %}

                                                                        {% endblock dataprivacy_download_data_registry %}

                                                                    {% endif %}
                                                                    {% if progress.regerrors > 0 and progress.regsubmissions == 1%}
                                                                        <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;white-space: normal !important;word-wrap: break-word !important;" href="{{request.route_url('CleanErrorLogs',user=activeProject["owner"].user_name,project=activeProject.project_cod,formid='registry') }}"><i class="fa fa-bug"></i> {{ _("Show submissions with conflicts") }}</a>
                                                                        <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;white-space: normal !important;word-wrap: break-word !important;" href="{{request.route_url('downloadErrorLogDocumentRegistry',user=activeProject["owner"].user_name,project=activeProject.project_cod,formid='registry') }}"><i class="fa fa-cloud-download"></i> {{ _("Download submissions with conflicts") }}</a>
                                                                    {% endif %}
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            {% endif %}
                                            {% if progress.regsubmissions == 1  or progress.regsubmissions == 2 %}
                                                <div class="row">
                                                    {% if progress.regsubmissions == 1 %}
                                                        {% if progress.regtotal > 0 %}
                                                            <div class="col-md-6">
                                                                <button onclick="location.href ='{{ request.route_url('closeregistry',user=activeProject["owner"].user_name, project=activeProject.project_cod) }}'" class="btn btn-danger btn-rounded btn-block" href="#"><i class="fa fa-stop"></i> {{ _("Finish registration") }}</button>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <button onclick="location.href ='{{ request.route_url('cancelregistry',user=activeProject["owner"].user_name, project=activeProject.project_cod) }}'" class="btn btn-danger btn-rounded btn-block" href="#"><i class="fa fa-undo"></i> {{ _("Cancel registration") }}</button>
                                                            </div>
                                                        {% else %}
                                                            <div class="col-md-12">
                                                                <button onclick="location.href = '{{ request.route_url('cancelregistry', user=activeProject["owner"].user_name, project=activeProject.project_cod) }}'" class="btn btn-danger btn-rounded btn-block" href="#"><i class="fa fa-undo"></i> {{ _("Cancel registration") }}</button>
                                                            </div>
                                                        {% endif %}
                                                    {% endif %}
                                                    {% if progress.regsubmissions == 2 %}

                                                        <div class="col-md-12">
                                                            {% if progress.assessments|length == 0 %}
                                                                <button onclick="location.href = '{{ request.route_url('cancelregistry',user=activeProject["owner"].user_name, project=activeProject.project_cod) }}'" class="btn btn-danger btn-rounded btn-block" href="#"><i class="fa fa-undo"></i> {{ _("Cancel registration") }}</button>
                                                            {% endif %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}

                                {% if activeProject["project_template"] != 1 %}
                                    {% for assessment in progress.assessments %}
                                        {% if assessment.ass_status == 1 or assessment.ass_status == 2 %}
                                            <div class="ibox float-e-margins">
                                                <div class="ibox-title">

                                                    <div class="ibox-tools">
                                                        <div class="row" style="padding: 5px">
                                                            <table style="width: 100%">
                                                                <tbody>
                                                                    <tr>
                                                                        <td style="vertical-align: middle; width: 50%;text-align: left;">
                                                                            <h5 style=" margin: initial">{{ _("Trial data collection") }}: {{ assessment.ass_desc }}</h5>
                                                                        </td>
                                                                        <td style="vertical-align: middle; text-align: center">
                                                                            {% set pbtype = "progress-bar-info" %}
                                                                            {% if progress.asssubmissions == 0 %}
                                                                                <div class="small" style="text-align: left">{{ _("Not yet started") }}</div>
                                                                            {% endif %}
                                                                            {% if assessment.ass_status == 1 %}
                                                                                <div class="small" style="text-align: left">{{ _("On going") }}</div>
                                                                            {% endif %}
                                                                            {% if assessment.ass_status == 2 %}
                                                                                <div class="small" style="text-align: left">{{ _("Closed") }}</div>
                                                                                {% if assessment.assperc >= 100 %}
                                                                                    {% set pbtype = "progress-bar-success" %}
                                                                                {% else %}
                                                                                    {% set pbtype = "progress-bar-warning" %}
                                                                                {% endif %}
                                                                            {% endif %}
                                                                            <div class="progress progress-mini">
                                                                                <div style="width: {{ assessment.assperc }}%;" class="progress-bar {{ pbtype }}"></div>
                                                                            </div>
                                                                        </td>
                                                                        <td style="vertical-align: middle;text-align: center; width: 10%">
                                                                            <a class="collapse-link">
                                                                                <i class="fa fa-chevron-{% if assessment.ass_status == 2 %}down{% else %}up{% endif %}"></i>
                                                                            </a>
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="ibox-content" {% if assessment.ass_status == 2 %}style="display: none" {% endif %}>
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <h3>{{ _("Statistics") }}</h3>
                                                            <div id="pie{{ assessment.ass_cod }}"></div>
                                                            <table class="table table-striped">
                                                                <tbody>
                                                                    <tr>
                                                                        <td>{{ _("Total number of participants") }}: </td>
                                                                        <td>{{ assessment.submissions }}</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td style="vertical-align: inherit">{{ _("Number of submissions") }}: </td>
                                                                        <td style="vertical-align: inherit">{{ assessment.asstotal }} {% if assessment.asstotal > 0 %}({{ assessment.assperc|round(1, 'floor') }}%){% endif %}</td>

                                                                    </tr>
                                                                    <tr>
                                                                        <td {% if assessment.errors > 0 and assessment.ass_status == 1%}style="color: #ed5565;" {% endif %}>{{ _("Submissions with conflicts") }}:</td>
                                                                        <td {% if assessment.errors > 0 and assessment.ass_status == 1%}style="color: #ed5565;" {% endif %}>{{ assessment.errors }}</td>
                                                                    </tr>
                                                                    <tr>
                                                                        <td>{{ _("Last submission") }}</td>
                                                                        <td>{{ assessment.lastass }}</td>
                                                                    </tr>

                                                                    {% if assessment.ass_status == 1 %}

                                                                        {% block upload_data_assessment scoped%}

                                                                        {% endblock upload_data_assessment %}

                                                                        {% block enketo_information_assessment scoped%}

                                                                        {% endblock enketo_information_assessment %}

                                                                    {% endif %}

                                                                    <tr>
                                                                        <td colspan="2">
                                                                            {% block rhomis_btns_for_datacollection scoped%}

                                                                                {% if assessment.asstotal > 0 %}
                                                                                    <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('EditDataAssessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,formid='assessment',codeid=assessment.ass_cod) }}" href="#"><i class="fa fa-table"></i> {{ _("View and edit data") }}</a>
                                                                                    <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('downloadDataAssessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,formid='assessment',codeid=assessment.ass_cod, formatid='csv') }}"><i class="fa fa-cloud-download"></i> {{ _("Download data in .CSV format") }}</a>
                                                                                    <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" href="{{ request.route_url('downloadDataAssessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,formid='assessment',codeid=assessment.ass_cod, formatid='xlsx') }}"><i class="fa fa-cloud-download"></i> {{ _("Download data in .XLSX format") }}</a>

                                                                                    {% block dataprivacy_download_data_assessment scoped%}

                                                                                    {% endblock dataprivacy_download_data_assessment %}

                                                                                    {% if assessment.ass_status == 1%}
                                                                                    {% endif %}
                                                                                {% endif %}
                                                                                {% if assessment.errors > 0 and assessment.ass_status == 1%}
                                                                                    <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;white-space: normal !important;word-wrap: break-word !important;" href="{{request.route_url('CleanErrorLogsAssessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,formid='assessment',codeid=assessment.ass_cod) }}"><i class="fa fa-bug"></i> {{ _("Show submissions with conflicts") }}</a>
                                                                                    <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;white-space: normal !important;word-wrap: break-word !important;" href="{{request.route_url('downloadErrorLogDocumentAssessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,formid='assessment',codeid=assessment.ass_cod) }}"><i class="fa fa-cloud-download"></i> {{ _("Download submissions with conflicts") }}</a>
                                                                                {% endif %}

                                                                            {% endblock rhomis_btns_for_datacollection %}
                                                                        </td>
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        {% if assessment.asstotal > 0 %}
                                                            <div class="col-md-6">
                                                                {% if assessment.ass_status == 1 %}
                                                                    <a class="btn btn-danger btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" onclick="location.href = '{{ request.route_url('closeassessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,assessmentid=assessment.ass_cod) }}'"><i class="fa fa-stop"></i> {{ _("Finish") }} {{ assessment.ass_desc }}</a>
                                                                {% endif %}
                                                            </div>
                                                            <div class="col-md-6">
                                                                {% if assessment.ass_status == 1 %}
                                                                    <a class="btn btn-danger btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" onclick="location.href = '{{ request.route_url('cancelassessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,assessmentid=assessment.ass_cod) }}'"><i class="fa fa-stop"></i> {{ _("Cancel") }} {{ assessment.ass_desc }}</a>
                                                                {% endif %}
                                                            </div>
                                                        {% else %}
                                                            <div class="col-md-12">
                                                                {% if assessment.ass_status == 1 %}
                                                                    <a class="btn btn-danger btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" onclick="location.href = '{{ request.route_url('cancelassessment',user=activeProject["owner"].user_name, project=activeProject.project_cod,assessmentid=assessment.ass_cod) }}'"><i class="fa fa-stop"></i> {{ _("Cancel") }} {{ assessment.ass_desc }}</a>
                                                                {% endif %}
                                                            </div>
                                                        {% endif %}

                                                    </div>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}


                                {% if activeProject["project_template"] != 1 %}
                                    {% if total_ass_records > 5 or (activeProject.project_registration_and_analysis == 1 and progress.regtotal >=5)%}
                                        {%  if activeProject["access_type"] not in [4] %}
                                            <div class="ibox float-e-margins" >
                                                <div class="ibox-title">
                                                    <h5>{{ _("Analysis") }}</h5>
                                                </div>
                                                <div class="ibox-content">
                                                    {% if progress.metadata %}
                                                        <a class="btn btn-success btn-rounded btn-block" style="width: 100%; overflow: hidden;text-overflow: ellipsis;" onclick="location.href = '{{request.route_url('createAnalysis')}}' "><i class="fa fa-bar-chart-o"></i> {{ _("Start analysis") }}</a>
                                                    {% else %}
                                                        <div class="text-center">
                                                            {{ _("To do the data analysis you must complete the section: ") }}<br><br>
                                                            <a class="btn btn-primary btn-rounded " href="{{ request.route_url('Metadata', user=activeProject["owner"].user_name, project=activeProject.project_cod) }}"><i class="fa fa-file-text"></i> {{ _("Trial documentation") }}</a>
                                                        </div>
                                                    {% endif %}
                                                    <br>
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}

                                {% block communityLink %}

                                {% endblock communityLink %}

                                {% block supportTicketLink %}

                                {% endblock supportTicketLink %}

                            </div>
                        </div>


                        {% block piesFieldAgents %}
                            {% if progress.regtotal > 0 %}

                                <script>
                                    c3.generate({
                                            bindto: '#pieRegistry',
                                            size: {
                                                height: 200,
                                            },
                                            data:{
                                                x: 'x',
                                                columns: [
                                                    ["x",
                                                        {% for fieldAgent in fieldagents["registry"] %}
                                                            "{{ fieldAgent["User"] }}",
                                                        {% endfor %}
                                                    ],
                                                    ["{{ _("Number of submissions") }}",
                                                        {% for fieldAgent in fieldagents["registry"] %}
                                                            "{{ fieldAgent["Count"] }}",
                                                        {% endfor %}
                                                    ]
                                                ],
                                                type : 'bar',
                                                color: function(inColor, data) {
                                                    var colors = ['#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6'];

                                                    if(data.index !== undefined) {
                                                        return colors[data.index];
                                                    }

                                                    return inColor;
                                                }
                                            },
                                            axis: {
                                                rotated: true,
                                                x: {
                                                    type: 'category'
                                                },
                                                y: {
                                                    tick: {
                                                        values: [
                                                            {% for fieldAgent in fieldagents["registry"] %}
                                                            "{{ fieldAgent["Count"] }}",
                                                        {% endfor %}
                                                        ]
                                                    }
                                                }
                                            },
                                            legend: {
                                                show: false
                                            }
                                        });

                                </script>
                            {% endif %}

                            {% for fieldAgentAssess in fieldagents["Assessments"] %}
                                {% if fieldAgentAssess["Values"] %}
                                <script>
                                    c3.generate({
                                            bindto: '#pie{{ fieldAgentAssess["Name"] }}',
                                            size: {
                                                height: 200,
                                            },
                                            data:{
                                                x: 'x',
                                                columns: [
                                                    ["x",
                                                        {% for fieldAgent in fieldAgentAssess["Values"] %}
                                                            "{{ fieldAgent["User"] }}",
                                                        {% endfor %}
                                                    ],
                                                    ["{{ _("Number of submissions") }}",
                                                        {% for fieldAgent in fieldAgentAssess["Values"] %}
                                                            "{{ fieldAgent["Count"] }}",
                                                        {% endfor %}
                                                    ]
                                                ],
                                                type : 'bar',
                                                color: function(inColor, data) {
                                                    var colors = ['#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6','#1ab394', '#BABABA', '#f8ac59','#1c84c6'];

                                                    if(data.index !== undefined) {
                                                        return colors[data.index];
                                                    }

                                                    return inColor;
                                                }
                                            },
                                            axis: {
                                                rotated: true,
                                                x: {
                                                    type: 'category'
                                                },
                                                y: {
                                                    tick: {
                                                        values: [
                                                            {% for fieldAgent in fieldAgentAssess["Values"] %}
                                                                "{{ fieldAgent["Count"] }}",
                                                            {% endfor %}
                                                        ]
                                                    }
                                                }
                                            },
                                            legend: {
                                                show: false
                                            }
                                        });
                                </script>
                                {% endif %}
                            {% endfor %}
                        {% endblock %}

                    {% else %}
                        <div class="middle-box text-center loginscreen animated fadeInDown">
                            <p>{{ _("Let's start!") }}</p>
                            <a class="btn btn-primary" href="{{ request.route_url('newproject') }}">{{ _("Create a new project") }}</a>
                            <br>
                            <br>
                            <a class="btn btn-success btn-rounded  btn-xs" style="color: white" href="https://climmob.net/blog/wiki/3-create-a-new-project/" target="_blank"><i class="fa fa-question-circle"></i> {{  _("Show help") }}</a>
                        </div>
                    {% endif %}
                {% endblock pagecontent %}
            </div>
            <div class="footer">
                {% block footer %}
                    <div class="pull-right">
                        {{ request.h.get_version() }}
                    </div>
                    <div>
                        <strong>{{ _("Copyright") }}</strong> {{ _("{}, MrBot Software Solutions").format(request.h.get_year()) }}
                    </div>
                {% endblock footer %}
            </div>
        </div>

        {% block chat %}
            <div class="small-chat-box fadeInRight animated" style="bottom:10px;left: 60px; right: initial;z-index: 10000">

                <div class="heading" draggable="true">
                    {{ _("Send us feedback") }}
                    <i class="fa fa-remove pull-right open-small-chat" style="height: 20px; width: 20px; padding: 2px 2px"></i>
                </div>

                <div class="content" id="chatDetailsMessage">

                </div>

                <div class="form-chat">
                    <div class="input-group input-group-sm">
                        <input type="text" class="form-control" id="msgFeedback" required oninvalid="this.setCustomValidity('{{ _("Write the feedback message.") }}')" onchange="this.setCustomValidity('')">
                        <span class="input-group-btn">
                            <button class="btn btn-primary" type="button" id="sendFeedback">{{ _("Send") }}</button>
                        </span>
                    </div>
                </div>

            </div>
            <div id="small-chat" style="bottom:10px;left: 10px; right: initial;z-index: 10000">
                {% if counterChat > 0 %}
                    <span class="badge badge-danger " >{{ counterChat }}</span>
                {% endif %}
                <a class="open-small-chat" style="padding: initial; height: 43px;width: 43px;font-weight: bold">
                    <i class="fa fa-comments"></i><br>{{ _("Chat") }}
                </a>
            </div>

            <script>
                $("#sendFeedback").click(function () {
                    $("#sendFeedback").prop('disabled', true);
                    if ($("#msgFeedback")[0].checkValidity()) {
                        $.ajax({
                            url: '{{ request.route_url('sendFeedbackToBot') }}',
                            //datatype: "json",
                            type: "POST",
                            data: {
                                "csrf_token": '{{ request.session.get_csrf_token() }}',
                                "Apikey": "{{ activeUser.apikey }}",
                                "Body": JSON.stringify(
                                    {
                                        "message": $("#msgFeedback").val()
                                    }
                                )
                            },
                            success: function (respuesta) {

                                showMessage(respuesta)
                                $("#msgFeedback").val("");
                                $("#sendFeedback").prop('disabled', false);
                            },
                            error: function (respuesta) {
                                toastr.error(respuesta.responseText);
                                $("#sendFeedback").prop('disabled', false);
                            }
                        });
                    }else {
                        $("#msgFeedback")[0].reportValidity()
                    }
                });


                $("#small-chat").click(function () {
                    $.ajax({
                            url: '{{ request.route_url('readFeedback') }}',
                            type: "GET",
                            data: {
                                "Apikey": "{{ activeUser.apikey }}"
                            },
                            success: function (respuesta){
                                showMessage(respuesta)
                            },
                            error: function (respuesta) {
                                toastr.error(respuesta.responseText);
                            }
                        });
                })

                function showMessage(respuesta)
                {
                    information = JSON.parse(respuesta);
                    all ="";
                    if (information.read.length != 0 || information.unread.length != 0)
                    {
                        for (msg in information.read) {
                            if (information.read[msg].chat_tofrom == 2) {
                                all += "<div class='left'><div class='author-name'>{{ _('ClimMob Team') }} </div><div class='chat-message active'><p style='margin: 0 0 0px'>" + information.read[msg].chat_message + "</p><small class='chat-date'>" + information.read[msg].chat_date.split(" ")[1] + "</small></div></div>"
                            } else {
                                all += "<div class='right'><div class='author-name'>" + information.read[msg].user_name + "</div><div class='chat-message'><p style='margin: 0 0 0px'>" + information.read[msg].chat_message + "</p><small class='chat-date'>" + information.read[msg].chat_date.split(" ")[1] + "</small></div></div>"
                            }

                        }

                        if (information.unread.length != 0) {
                            all += "<div class='right' style='width:100%; text-align:center; background-color: #1c84c6;height: 12px;color: #fff;'><b>{{ _("Unread messages") }}</b></div>"
                            for (msg in information.unread) {
                                if (information.unread[msg].chat_tofrom == 2) {
                                    all += "<div class='left'><div class='author-name'>{{ _('ClimMob Team') }} </div><div class='chat-message active'><p style='margin: 0 0 0px'>" + information.unread[msg].chat_message + "</p><small class='chat-date'>" + information.read[msg].chat_date.split(" ")[1] + "</small></div></div>"
                                } else {
                                    all += "<div class='right'><div class='author-name'>" + information.unread[msg].user_name + "</div><div class='chat-message'><p style='margin: 0 0 0px'>" + information.unread[msg].chat_message + "</p><small class='chat-date'>" + information.unread[msg].chat_date.split(" ")[1] + "</small></div></div>"
                                }
                            }
                        }
                    }else {
                        all += "<div class='left'><div class='author-name'>{{ _('ClimMob Team') }} </div><div class='chat-message active'><p style='margin: 0 0 0px'>{{ _("Hi there! Any question or feedback?") }}</p></div></div>"
                    }

                    $("#chatDetailsMessage").html(all)
                    //$("#chatDetailsMessage").animate({ scrollTop: $("#chatDetailsMessage")[0].scrollHeight}, 1000);
                }
            </script>
        {% endblock %}

{#        {% if withsidebar %}#}
{#            <div id="right-sidebar" class="animated">#}
{#                <div class="sidebar-container">#}
{#                    <div class="tab-content">#}
{#                        {% block sidebarcontent %}#}
{#                            <div id="tab-1" class="tab-pane active">#}
{#                                <div class="sidebar-title text-center">#}
{#                                    {% if hasActiveProject %}#}
{#                                        <h3><i class="fa fa-tim"></i> {{ _("You have") }} {{ userProjects|length }} {{ request.h.pluralize(_("project"),userProjects|length) }}.</h3>#}
{#                                    {% else %}#}
{#                                        <h3><i class="fa fa-tim"></i> {{ _("You don't have projects.") }}</h3>#}
{#                                    {% endif %}#}
{#                                    <br/>#}
{#                                    <a class="btn btn-primary" href="{{ request.route_url('newproject') }}">{{ _("Add new project") }}</a><br><br>#}
{##}
{#                                    <a class="btn btn-primary" href="{{ request.route_url('cloneProject') }}">{{ _("Clone existing project") }}</a>#}
{#                                </div>#}
{#                                <ul class="sidebar-list">#}
{#                                    {% if hasActiveProject %}#}
{#                                        {% for project in userProjects %}#}
{#                                            {% include 'snippets/dashboard/project_details.jinja2' %}#}
{#                                        {% endfor %}#}
{#                                    {% endif %}#}
{#                                </ul>#}
{#                            </div>#}
{#                        {% endblock sidebarcontent %}#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        {% endif %}#}
    </div>

{% endblock body %}

{% block bodybottom %}
    <div class="modal inmodal" id="modal1" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content animated fadeIn">
                <div class="modal-header">
                    <button type="button" class="close" onclick="closeModal()"><span aria-hidden="true">&times;</span><span class="sr-only">{{ _("Close") }}</span></button>
                    <h4 class="modal-title" id="modaltitle">{{ _("Terms of service") }}</h4>
                </div>
                <div class="modal-body">

                    <div id="modaliframecont" class="embed-responsive embed-responsive-16by9">
                        <iframe class="embed-responsive-item" id="modaliframe"></iframe>
                    </div>


                </div>
                <div class="modal-footer">
                    <button id="modalmainbutton"type="button" class="btn btn-primary pull-left" onclick="$('#modaliframe').contents().find('.clm-act-button').trigger( 'click' );">{{ _("Something here") }}</button>
                    <button type="button" class="btn btn-white" onclick="closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock bodybottom %}

{% block toastr %}
    {% set toastrmessage = request.session.pop_flash() %}
    {% if toastrmessage|length > 0 %}
        <script>
            toastr.options = {
                closeButton: true,
                progressBar: true,
                showMethod: 'slideDown',
                timeOut: 4000
            };
            toastr.success("{{ toastrmessage[0] }}");
        </script>
    {% endif %}
{% endblock toastr %}

{% block script %}

    <script>
        $(document).ready(function() {

            var selectedLanguage = readCookie('_LOCALE_');
            if (selectedLanguage != null)
                $('#language').val(selectedLanguage);

            $("#language").bind('change', function() {
                setCookie('_LOCALE_', this.value, 365);
                location.reload();
            })


            {% if showHelp %}
                var tour = new Tour({
                steps: [
                    {
                        element: "#nav_libraries",
                        title: "{{ _("Libraries") }}",
                        content: "{{ _("Libraries allow you to save information that can be assigned to different projects.") }}.",
                        placement: "right"
                    },
                    {
                        element: "#nav_enumerators",
                        title: "{{ _("Field agents") }}",
                        content: "{{ _("Create a list of field agents that you can later use in projects") }}.",
                        placement: "right"
                    },
                    {
                        element: "#nav_technology",
                        title: "{{_("Technologies")}}",
                        content: "{{ _("Add or check if the ClimMob library has the necessary technologies for your project") }}.",
                        placement: "right"
                    },
                    {
                        element: "#nav_questions",
                        title: "{{ _("Questions") }}",
                        content: "{{ _("Create the questions that you want to use to evaluate in your projects") }}.",
                        placement: "right"
                    },
                    {
                        element:"#nav_downloads",
                        title: "{{ _("Downloads") }}",
                        content: "{{ _("ClimMob generates different output documents per project, in this menu option you could download the information") }}.",
                        placement: "right"
                    }
                   ],
                template: "<div class='popover tour' style='border-color: #23c6c8'><div class='arrow' style='border-right-color: #23c6c8'></div><h3 class='popover-title btn-info'></h3><div class='popover-content'></div><div class='popover-navigation'><div class='btn-group'> <button class='btn btn-sm btn-secondary'  data-role='prev'>{{ _("« Prev") }}</button> <button class='btn btn-sm btn-secondary' data-role='next'>{{ _("Next »") }}</button> </div>  <button class='btn btn-sm btn-danger' data-role='end'><i class='fa fa-close'></i> {{ _("Close") }}</button> </div>",
                backdrop: true,
                backdropContainer: 'body'
                });

                // Initialize the tour
                tour.init();
                tour.restart();

            {% endif %}

            {% if showRememberAfterCreateProject %}
                var tour = new Tour({
                steps: [
                        {
                            element: "#nav_libraries",
                            title: "{{ _("Update libraries") }}",
                            content: "{{ _("Remember that the libraries contain useful information for your projects, update them in the event that necessary information is missing for your new project") }}.",
                            placement: "right"
                        }
                       ],
                template: "<div class='popover tour' style='border-color: #23c6c8'><div class='arrow' style='border-right-color: #23c6c8'></div><h3 class='popover-title btn-info'></h3><div class='popover-content'></div><div class='popover-navigation'> <button class='btn btn-sm btn-danger' data-role='end'><i class='fa fa-close'></i> {{ _("Close") }}</button> </div>",
                backdrop: true,
                backdropContainer: 'body'
                });

                // Initialize the tour
                tour.init();
                tour.restart();

            {% endif %}



        });

        function seeHelp()
        {
            var tourFieldAgent = new Tour({
                steps: [
                            {
                                element: "#nav_enumerators",
                                title: "{{ _("Before assign field agents") }}",
                                content: "{{ _("First you have to add your field agents to the library then assign them to the project") }}.",
                                placement: "right"
                            }
                        ],
                template: "<div class='popover tour-tour tour-tour-0 fade show' style='border-color: #23c6c8'><div class='arrow' style='border-right-color: #23c6c8'></div><h3 class='popover-title btn-info'></h3><div class='popover-content'></div><div class='popover-navigation'><div class='btn-group' style='float: right'><a class='btn btn-sm btn-primary' href='{{ request.route_url('enumerators') }}'>{{ _("Go to add field agents") }}</a><button class='btn btn-sm btn-danger' data-role='end'><i class='fa fa-close'></i> {{ _("Close") }}</button> </div></div>",
                backdrop: true,
                backdropContainer: '#wrapper'
            });
            tourFieldAgent.init();
            tourFieldAgent.restart();
        }

        function setCookie(cookieName, cookieValue, nDays) {
            var today = new Date();
            var expire = new Date();

            if (nDays==null || nDays==0)
                nDays=1;

            expire.setTime(today.getTime() + 3600000*24*nDays);
            document.cookie = cookieName+"="+escape(cookieValue) + ";expires="+expire.toGMTString() + ";path=/";
        }

        function readCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }
        
    
        function copy() {
            var copyText = document.getElementById("aForCopy");

             /* Select the text field */
            copyText.select();

            /* Copy the text inside the text field */
            document.execCommand("copy");

        }

    </script>

{% endblock script %}

{% block script_extra %}

{% endblock script_extra %}

{% include 'snippets/loading.jinja2' %}

</body>

</html>
